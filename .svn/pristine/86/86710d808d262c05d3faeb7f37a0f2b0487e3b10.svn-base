<template>
  <div>
    <div>
      <div class="pro-center">
        <div class="title">产品中心</div>
        <div class="clearfix">
          <div class="product clearfix fll" @click="addItem">
            <div class="clearfix my-upload-icon">
              <div class="add-num fll">+</div>
              <div class="add-pro fll">添加产品</div>
            </div>
          </div>
          <div class="product-item fll" v-for="(item,index) in tableData"
               style="margin-right: 25px;margin-bottom: 20px">
            <div class="clearfix mt15">
              <div class="name fll">产品名称：</div>
              <input :disabled="!item.save" type="text" class="fll" v-model="item.productName">
            </div>
            <div class="clearfix mt15">
              <div class="name fll">额度：</div>
              <input :disabled="!item.save" type="text" class="fll" v-model="item.moneyLimit">
            </div>
            <div class="clearfix mt15">
              <div class="name fll">利息：</div>
              <input :disabled="!item.save" type="text" class="fll" v-model="item.rate">
            </div>
            <div class="clearfix mt15">
              <div class="name fll">归还方式：</div>
              <input :disabled="!item.save" type="text" class="fll" v-model="item.productRepaymentMethod">
            </div>
            <div class="clearfix mt15">
              <div class="name fll">使用年限：</div>
              <input :disabled="!item.save" type="text" class="fll" v-model="item.productLife">
            </div>
            <div class="clearfix mt15">
              <div class="name fll">贷款类型：</div>
              <input :disabled="!item.save" type="text" class="fll" v-model="item.productLoanType">
            </div>
            <div class="clearfix">
              <div class="save fll" @click="delectProduct(item.productId)">删除</div>
              <div class="edit fll" @click="editProduct(item.productId)">编辑</div>
            </div>
          </div>
        </div>

      </div>

      <div class="page" style="float: right;margin-top: 30px">
        <el-pagination
          @size-change="handleSizeChange"
          @current-change="handleCurrentChange"
          background

          :page-size="size"
          :pager-count="5"
          layout="prev, pager, next"
          :total="count">
        </el-pagination>
      </div>

      <!--蒙版-->
      <div v-if="isMask" class="mask" @click="closeMask"></div>
      <div class="pro-detail clearfix" v-if="isProduct">
        <div class="pro-title">产品详情</div>

        <div class="pro-main">
          <div class="clearfix">
            <div class="fll same">产品头像：</div>
            <div class="fll clearfix wenzi">
              <productImg v-model="productDetailData.productLogo"></productImg>
              <div class="wenzi">支持JPG/JPEG/PNG格式图片，照片不大于2M</div>
            </div>
          </div>
          <div class="pro-item clearfix">
            <div class="fll">
              <div class="clearfix item-h31">
                <div class="fll same">产品名称：</div>
                <input type="text" v-model="productDetailData.productName">
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">归还方式：</div>
                <el-select v-model="productDetailData.productRepaymentMethod" placeholder="请选择" class="checkbox-same">
                  <el-option
                    v-for="item in returnData"
                    :key="item.prId"
                    :label="item.prName"
                    :value="item.prId">
                  </el-option>
                </el-select>
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">贷款类型：</div>
                <el-select v-model="productDetailData.productLoanType" placeholder="请选择" class="checkbox-same">
                  <el-option
                    v-for="item in loanTypeData"
                    :key="item.id"
                    :label="item.typeName"
                    :value="item.id">
                  </el-option>
                </el-select>
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">业务类型：</div>
                <el-select v-model="productDetailData.productType" placeholder="请选择" class="checkbox-same">
                  <el-option
                    v-for="item in businessData"
                    :key="item.id"
                    :label="item.busName"
                    :value="item.id">
                  </el-option>
                </el-select>
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">身份要求：</div>
                <el-select v-model="productDetailData.productIdentity" placeholder="请选择" class="checkbox-same">
                  <el-option
                    v-for="item in identifyData"
                    :key="item.id"
                    :label="item.identityName"
                    :value="item.id">
                  </el-option>
                </el-select>
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">职业要求：</div>
                <el-select v-model="productDetailData.productOccupation" placeholder="请选择" class="checkbox-same">
                  <el-option
                    v-for="item in jobData"
                    :key="item.jobId"
                    :label="item.jobName"
                    :value="item.jobId">
                  </el-option>
                </el-select>
              </div>

            </div>
            <div class="fll pro-right ml50">
              <div class="clearfix item-h31">
                <div class="fll same">额&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;度：</div>
                <div class="fll same">
                  <input type="text" class="input-w60" v-model="productDetailData.productStartAmount">～<input
                  type="text" class="input-w60" v-model="productDetailData.productEndAmount">&nbsp;&nbsp;万
                </div>

              </div>
              <div class="clearfix item-h31">
                <div class="fll same">利&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;息：</div>
                <div class="fll same">
                  <input type="text" class="input-w60" v-model="productDetailData.productInterest">&nbsp;&nbsp;%
                </div>

              </div>
              <div class="clearfix item-h31">
                <div class="fll same">使用期限：</div>
                <el-select v-model="productDetailData.productLife" placeholder="请选择">
                  <el-option
                    v-for="item in yearData"
                    :key="item.id"
                    :label="item.lifeName"
                    :value="item.id">
                  </el-option>
                </el-select>
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">发行机构：</div>
                <input type="text" v-model="productDetailData.productPublisher">
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">放款时间：</div>
                <input type="text" class="input-w60" v-model="productDetailData.producLoanLength">

                <select v-model="productDetailData.productTimeType" placeholder="请选择" style="width: 50px;">
                  <option
                    v-for="item in data"
                    :key="item.id"
                    :label="item.tian"
                    :value="item.id">
                  </option>
                </select>
              </div>
              <div class="clearfix item-h31">
                <div class="fll same">年龄要求：</div>
                <div class="fll same">
                  <input type="text" class="input-w60" v-model="productDetailData.productMinAge">～<input type="text"
                                                                                                         class="input-w60"
                                                                                                         v-model="productDetailData.productMaxAge">&nbsp;&nbsp;岁
                </div>
              </div>
            </div>
          </div>

          <div class="clearfix">
            <div class="fll same">贷款条件：</div>
            <el-select v-model="productDetailData.productProperty"
                       @change="handlerChange" multiple placeholder="请选择"
                       style="width:300px;margin-bottom: 10px">
              <el-option
                v-for="item in loanData"
                :key="item.lrId"
                :label="item.lrName"
                :value="item.lrId">
              </el-option>
            </el-select>
          </div>
          <div class="clearfix">
            <div class="fll same">条件：</div>
            <div class="fll">
              <textarea name="" cols="30" rows="10"
                        style="width: 438px;height: 80px;color:rgba(81,81,81,1);padding: 5px 5px;"
                        v-model="productDetailData.productCondition"></textarea>
            </div>
          </div>
          <div class="clearfix mt10">
            <div class="fll same">特点：</div>
            <div class="fll">
              <textarea name="" cols="30" rows="10"
                        style="width: 438px;height: 80px;color:rgba(81,81,81,1);padding: 5px 5px;"
                        v-model="productDetailData.productCharacteristic"></textarea>
            </div>
          </div>
          <div class="btn" @click="proSave(productDetailData.productId)">
            保存
          </div>
        </div>

      </div>

    </div>
  </div>
</template>

<script>
  import productImg from '../../../component/productImg'

  export default {
    name: "productCen",
    data() {
      return {
        data: [
          {id: '天', tian: '天'},
          {id: '时', tian: '时'}
        ],
        tableData: [],
        isShowing: true,
        isMask: false,
        isProduct: false,
        productList: [],

        page: 1,
        size: 5,
        count: 1,
        jobData: [
          {
            jobId: '',
            jobName: ''
          }
        ],       //获取职业


        loanData: [
          {
            lrId: '',
            lrName: ''
          }
        ],       //获取贷款要求


        returnData: [
          {
            prId: '',
            prName: ''
          }
        ],      //获取归还条件


        loanTypeData: [
          {
            id: '',
            typeName: '',
          }
        ],    //贷款类型


        yearData: [
          {
            id: '',
            lifeName: '',
          }
        ],        //使用年限


        businessData: [
          {
            id: '',
            busName: '',
          }
        ],     //业务类型


        identifyData: [
          {
            id: '',
            identityName: '',
          }
        ],      //身份要求


        productDetailData: {
          // productId:'',
          productName: '',
          producLoanLength: '',
          productRepaymentMethod: '',
          productCharacteristic: '',//特点
          productPublisher: '',//发型机构
          productInterest: '',//利率
          productLoanType: '',//贷款类型
          productOccupation: '',//职业
          productIdentity: '',//身份
          productTimeType: '',
          productType: '',
          productMinAge: '',
          productMaxAge: '',
          productProperty: '',//资产
          productStartAmount: '',//额度
          productEndAmount: '',
          productLife: '',//年限
          productCondition: '',//条件
          agencyId: '',
          productLogo: '',
        },
      }
    },
    components: {
      productImg
    },
    methods: {
      handlerChange(val) {
        console.log(this.productDetailData.productProperty)
        let index = val.indexOf(0)
        if (index > -1 && index === val.length - 1) {
          this.productDetailData.productProperty = [0]
        } else if (index > -1) {
          this.productDetailData.productProperty.splice(index, 1)
        } else {
          console.log(val)
          this.productDetailData.productProperty = val
        }
      },
      handleCurrentChange(val) {
        this.page = val
        this.getProData()
      },
      handleSizeChange(val) {
        this.size = val
        this.getProData()
      },
      editProduct(id) {
        this.isMask = true
        this.isProduct = true
        this.$axios.get(`product/updateProductById/${id}`).then(res => {
          let {
            productId,
            productName,
            producLoanLength,
            productRepaymentMethod,
            productCharacteristic,//特点
            productPublisher,//发型机构
            productInterest,//利率
            productLoanType,//贷款类型
            productOccupation,//职业
            productIdentity,//身份
            productTimeType,
            productType,
            productMinAge,
            productMaxAge,
            productProperty,//资产
            productStartAmount,//额度
            productEndAmount,
            productLife,//年限
            productCondition,//条件
            productLogo,
          } = res
          this.productDetailData = {
            productId,
            productName,
            producLoanLength,
            productRepaymentMethod,
            productCharacteristic,//特点
            productPublisher,//发型机构
            productInterest,//利率
            productLoanType,//贷款类型
            productOccupation,//职业
            productIdentity,//身份
            productTimeType,
            productType,
            productMinAge,
            productMaxAge,
            productProperty,//资产
            productStartAmount,//额度
            productEndAmount,
            productLife,//年限
            productCondition,//条件
            productLogo,
          }
          this.productDetailData.productProperty = res.productProperty.split(',').map(item => {
            return parseInt(item)
          })
        })
      },
      proSave(id) {

        if (id) {
          let data = new FormData()
          for (let item in this.productDetailData) {
            data.append(item, this.productDetailData[item])
          }
          this.$axios.post(`product/updateProduct`, data).then(res => {
            console.log('save', res);
            if(res.status === 200){
              this.$message.success(res.msg)
              this.isMask = false
              this.isProduct = false
              this.getProData()
            }
          })
        } else {
          let data = new FormData()
          for (let item in this.productDetailData) {
            if(item === 'agencyId'){
              data.append(item,this.$store.state.userInfo.id)
            }else{
              data.append(item, this.productDetailData[item])
            }

          }
          data.delete('productId')
             this.$axios.post(`product/addProduct`,data).then(res=>{
               console.log('add',res);
               if(res.status === 200){
                 this.$message.success(res.msg)
                 this.isMask = false
                 this.isProduct = false
                 this.getProData()

               }else{
                 this.$message.warning(res.msg)
               }
             })
        }
      },
      //添加产品
      addItem() {
        this.isMask = true
        this.isProduct = true
      },
      delectProduct(id) {
        this.$axios.get(`product/deleteProduct/${id}`).then(res => {
          if (res.status === 200) {
            this.$message.success(res.msg)
            this.getProData()
          } else {
            this.$message.warning(res.msg)
          }
        })
      },

      //获取职业
      getJob() {
        this.$axios.get('get/getJob').then(res => {
          this.jobData = res
        })
      },
      //获取贷款要求
      getLoan() {
        this.$axios.get('get/getLoanRequirements').then(res => {
          this.loanData = res
        })
      },
      //获取归还条件
      getReturn() {
        this.$axios.get('get/getProductRepaymentMethod').then(res => {
          this.returnData = res
        })
      },
      //贷款类型
      getLoanType() {
        this.$axios.get('get/getLoanType').then(res => {
          this.loanTypeData = res
        })
      },
      //使用年限
      getYear() {
        this.$axios.get('get/getServiceLife').then(res => {
          this.yearData = res
        })
      },
      //业务类型
      getBusinessType() {
        this.$axios.get('get/getType').then(res => {
          this.businessData = res
        })
      },
      //身份要求
      getIdentify() {
        this.$axios.get('get/getIdentity').then(res => {
          this.identifyData = res
        })
      },
      //  关闭蒙版
      closeMask() {
        this.isMask = false
        this.isProduct = false
      },
      getProData() {
        this.$axios.get(`product/selectProductByAgency/${this.$store.state.userInfo.id}/${this.page}/${this.size}`).then(res => {
          if (res) {
            this.tableData = res.list.map(item => {
              let moneyLimit = item.productStartAmount + "~" + item.productEndAmount + "万"
              let rate = item.productInterest + '%'
              return {...item, moneyLimit, save: false, rate}
            })
            this.count = res.totalCount
          } else {
            this.tableData = []
          }
        })

      }
    },
    created() {
      this.getJob()
      this.getLoan()
      this.getReturn()
      this.getLoanType()
      this.getYear()
      this.getBusinessType()
      this.getIdentify()
      this.getProData()
    }
  }
</script>

<style scoped lang="scss">
  .mt15 {
    margin-top: 15px;
  }

  .wenzi {
    width: 400px;
    margin-left: 5px;
    font-size: 12px;
    font-family: PingFangSC-Regular;
    font-weight: 400;
    color: rgba(155, 155, 155, 1);
    line-height: 31px;
  }

  .mt10 {
    margin-top: 10px;
  }

  .ml50 {
    margin-left: 50px;
  }

  .mask {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    right: 0;
    background-color: #000;
    opacity: 0.5;
    z-index: 100;
  }

  .pro-detail {
    position: fixed;
    left: 50%;
    top: 5%;
    transform: translateX(-50%);
    width: 600px;
    background: rgba(255, 255, 255, 1);
    z-index: 999;
    .pro-title {
      width: 600px;
      height: 40px;
      background: rgba(208, 172, 86, 1);
      font-size: 16px;
      font-family: PingFangSC-Regular;
      font-weight: 400;
      color: rgba(255, 255, 255, 1);
      line-height: 40px;
      text-align: center;
    }
    .pro-main {
      padding-left: 50px;
      padding-right: 50px;
      box-sizing: border-box;
      .pro-item {
        padding-top: 10px;
        padding-bottom: 10px;
        box-sizing: border-box;
        /deep/ .el-input__inner {
          width: 140px;
          height: 24px;
          line-height: 31px;
          box-sizing: border-box;
        }
        /deep/ .el-input__icon {
          line-height: 24px;
        }
        .item-h31 {
          height: 31px;
          line-height: 31px;

        }
        input {
          width: 140px;
          height: 24px;
          line-height: 31px;
          box-sizing: border-box;
          padding-left: 3px;
          color: rgba(81, 81, 81, 1);
        }
        .input-w60 {
          width: 60px;
          height: 24px;
          line-height: 31px;
        }
      }
      .same {
        font-size: 12px;
        font-family: PingFangSC-Regular;
        font-weight: 400;
        color: rgba(155, 155, 155, 1);
        line-height: 31px;
      }

      .btn {
        width: 60px;
        height: 30px;
        background: rgba(208, 172, 86, 1);
        font-size: 14px;
        font-family: PingFangSC-Regular;
        font-weight: 400;
        color: rgba(255, 255, 255, 1);
        text-align: center;
        line-height: 30px;
        margin: 8px auto;
        cursor: pointer;
      }
    }

  }

  .mb15 {
    margin-bottom: 15px;
  }

  .pro-center {
    width: 944px;
    height: 667px;
    background: rgba(255, 255, 255, 1);
    padding: 0 0 0 56px;
    box-sizing: border-box;
    .title {
      height: 66px;
      font-size: 16px;
      font-family: PingFangSC-Medium;
      font-weight: 500;
      color: rgba(81, 81, 81, 1);
      line-height: 66px;
    }
    .product-item {
      width: 252px;
      height: 255px;
      background: rgba(255, 255, 255, 1);
      border: 1px solid rgba(217, 217, 217, 1);
      margin-right: 36px;
      position: relative;
      box-sizing: border-box;
      &:hover {
        box-shadow: 0px 0px 14px 0px rgba(217, 217, 217, 1);
      }
      input {
        width: 100px;
        height: 20px;
        box-sizing: border-box;
        padding-left: 3px;
        color: rgba(81, 81, 81, 1);
        /*border: none;*/
      }
      /deep/ .el-input__inner {
        height: 20px;
        line-height: 20px;
      }
      .name {
        width: 84px;
        height: 12px;
        font-size: 12px;
        font-family: PingFangSC-Regular;
        font-weight: 400;
        color: rgba(155, 155, 155, 1);
        line-height: 20px;
        margin-left: 22px;
      }
      .edit, .save {
        text-align: center;
        height: 26px;
        font-size: 12px;
        font-family: PingFangSC-Regular;
        font-weight: 400;
        width: 124px;
        line-height: 26px;
        background: rgba(217, 217, 217, 1);
        color: rgba(255, 255, 255, 1);
        border-radius: 3px;
      }
      .edit {
        position: absolute;
        right: 0;
        bottom: 0;
        cursor: pointer;
      }
      .save {
        position: absolute;
        left: 0;
        bottom: 0;
        cursor: pointer;
      }

    }
    .product {
      width: 252px;
      height: 255px;
      background: rgba(255, 255, 255, 1);
      border: 1px dashed rgba(217, 217, 217, 1);
      margin-right: 25px;
      position: relative;
      cursor: pointer;
      .my-upload-icon {
        position: absolute;
        left: 50%;
        top: 50%;
        .add-num {
          height: 53px;
          font-weight: 200;
          color: rgba(155, 155, 155, 1);
          line-height: 53px;
          font-size: 35px;
        }
        .add-pro {
          width: 64px;
          height: 53px;
          font-size: 16px;
          font-family: PingFangSC-Regular;
          font-weight: 400;
          color: rgba(155, 155, 155, 1);
          line-height: 53px;
          margin-left: 5px;
        }
      }
    }
    .save-btn {
      position: absolute;
      bottom: 0;
      display: block;
      cursor: pointer;
      height: 26px;
      width: 100%;
      color: #fff;
      border: none;
      background: rgba(208, 172, 86, 1);
      outline: none;
    }
  }

  /deep/ .el-select__caret {
    line-height: 20px;
  }
</style>
